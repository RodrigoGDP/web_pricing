<!-- Grid principal -->
<div class="grid-container" id="grid-container">
  {% for floor, units in grid.items() %}
  <div class="floor-label">P{{ floor }}</div>
  <div
    class="units-container"
    style="grid-template-columns: repeat({{ max_columns }}, 1fr);"
  >
    {% for unit in units %}
    <div class="unidad {{ unit.display_status }} {{ unit.css_class }}">
      <div class="unit-content">
        {% if vista_actual == 'proformas' %}
        <span class="proforma-count">{{ unit.proformas_count }}</span>
        {% elif vista_actual == 'codigo' %} {{ unit.codigo }} {% elif
        vista_actual == 'precio_m2' %} {{ unit.precio_m2|currency }} {% elif
        vista_actual == 'area_total' %} {{ unit.area_techada }} m² {% else %} {#
        Default to 'precio' view #} {% if unit.display_status == 'vendido' %} {{
        unit.precio_venta|currency }} {% else %} {{ unit.precio_lista|currency
        }} {% if unit.display_status == 'alerta-subir' %}
        <span class="arrow-icon">↑</span>
        {% endif %} {% endif %} {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% endfor %}
</div>

<!-- Actualización out-of-band del sidebar -->
<div id="sidebar-stats" hx-swap-oob="innerHTML">
  {% include '_sidebar_stats.html' %}
</div>

<!-- Actualización out-of-band del texto del botón -->
<span id="tipologia-button-text" hx-swap-oob="innerHTML">
  {% if tipologia_filtro %} {% if tipologia_filtro|length == 1 %} {{
  tipologia_filtro[0] }} {% else %} {{ tipologia_filtro|length }} tipologías
  seleccionadas {% endif %} {% else %} Todas las Tipologías {% endif %}
</span>

<!-- Actualización out-of-band del contenido del dropdown -->
<div id="tipologia-dropdown-content" hx-swap-oob="innerHTML">
  {% include '_tipologia_dropdown_content.html' %}
</div>
