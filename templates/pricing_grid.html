{% extends "base.html" %}

<!-- ESTE BLOQUE INYECTA EL SELECTOR DE PROYECTO EN LA CABECERA -->
{% block project_selector %}
    <select name="project" onchange="window.location.href='/pricing/' + this.value">
        {% for project in all_projects %}
        <option value="{{ project.nombre_proyecto }}" {% if project.nombre_proyecto == current_project %}selected{% endif %}>
            {{ project.nombre_proyecto }}
        </option>
        {% endfor %}
    </select>
{% endblock %}


<!-- EL RESTO DEL CONTENIDO VA AQUÍ -->
{% block content %}
<div class="pricing-page-wrapper">
    <!-- Este es el contenedor TARGET para las actualizaciones de HTMX -->
    <div id="pricing-content-wrapper">
        {% include '_filters_and_grid.html' %}
    </div>

    <div class="approval-table-container">
        <h3>Proformas por tipología</h3>
        <table class="approval-table">
            <thead>
                <tr>
                    <th>Tipología</th>
                    <th>Unidades disponibles</th>
                    <th>Número de proformas</th>
                    <th>Precio prom actual</th>
                    <th>Precio prom mercado</th>
                    <th>Precio prom sugerido</th>
                    <th>Triggers</th>
                    <th>Aprobación</th>
                </tr>
            </thead>
            <tbody>
                {% for row in approval_table_data %}
                <tr class="{% if row.has_alert %}highlight-red{% endif %}">
                    <td>{{ row.tipologia }}</td>
                    <td>{{ row.unidades_disponibles_str }}</td>
                    <td>{{ row.total_proformas }}</td>
                    <td>{{ row.avg_precio_m2|currency }}</td>
                    <td></td><td></td><td></td>
                    <td><select><option>Modificar</option><option>Aprobar</option><option>Rechazado</option></select></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block sidebar %}
<div id="sidebar-stats">
    {% include '_sidebar_stats.html' %}
</div>
{% endblock %}