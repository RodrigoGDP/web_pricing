<div class="secondary-filter-bar">
  <div class="dropdown-container">
    <button class="dropdown-toggle" type="button" onclick="toggleDropdown()">
      {% if tipologia_filtro %} {% if tipologia_filtro|length == 1 %} {{
      tipologia_filtro[0] }} {% else %} {{ tipologia_filtro|length }} tipologías
      seleccionadas {% endif %} {% else %} Todas las Tipologías {% endif %}
      <span class="dropdown-arrow">▼</span>
    </button>
    <div class="dropdown-content" id="tipologia-dropdown">
      <form
        hx-get="{{ url_for('pricing', project_name=current_project) }}"
        hx-target="#sidebar-stats"
        hx-trigger="change from:input[type='checkbox']"
        hx-swap="innerHTML"
        hx-include="[name='vista']"
      >
        <div class="checkbox-item">
          <input
            type="checkbox"
            id="all-tipologias"
            name="tipologia"
            value=""
            {%
            if
            not
            tipologia_filtro
            %}checked{%
            endif
            %}
            onchange="handleAllCheckbox(this)"
          />
          <label for="all-tipologias">Todas las Tipologías</label>
        </div>
        {% for tipo in all_tipologias %}
        <div class="checkbox-item">
          <input
            type="checkbox"
            id="tipologia-{{ loop.index }}"
            name="tipologia"
            value="{{ tipo }}"
            {%
            if
            tipo
            in
            tipologia_filtro
            %}checked{%
            endif
            %}
            onchange="handleIndividualCheckbox(this)"
          />
          <label for="tipologia-{{ loop.index }}">{{ tipo }}</label>
        </div>
        {% endfor %}
        <input type="hidden" name="vista" value="{{ vista_actual }}" />
      </form>
    </div>
  </div>

  <input type="hidden" name="vista" value="{{ vista_actual }}" />

  <button
    class="contrast {% if vista_actual == 'codigo' %}active-view{% endif %}"
    hx-get="{{ url_for('pricing', project_name=current_project, vista='codigo') }}"
    hx-target="#grid-container"
    hx-swap="innerHTML"
    hx-include="[name='tipologia']"
  >
    Código
  </button>
  <button
    class="contrast {% if vista_actual == 'precio' %}active-view{% endif %}"
    hx-get="{{ url_for('pricing', project_name=current_project, vista='precio') }}"
    hx-target="#grid-container"
    hx-swap="innerHTML"
    hx-include="[name='tipologia']"
  >
    Precio
  </button>
  <button
    class="contrast {% if vista_actual == 'precio_m2' %}active-view{% endif %}"
    hx-get="{{ url_for('pricing', project_name=current_project, vista='precio_m2') }}"
    hx-target="#grid-container"
    hx-swap="innerHTML"
    hx-include="[name='tipologia']"
  >
    Precio m2
  </button>
  <button
    class="contrast {% if vista_actual == 'proformas' %}active-view{% endif %}"
    hx-get="{{ url_for('pricing', project_name=current_project, vista='proformas') }}"
    hx-target="#grid-container"
    hx-swap="innerHTML"
    hx-include="[name='tipologia']"
  >
    Proformas
  </button>
  <button
    class="contrast {% if vista_actual == 'area_total' %}active-view{% endif %}"
    hx-get="{{ url_for('pricing', project_name=current_project, vista='area_total') }}"
    hx-target="#grid-container"
    hx-swap="innerHTML"
    hx-include="[name='tipologia']"
  >
    Área Total
  </button>
</div>

{% include '_grid_container.html' %}
