<!DOCTYPE html>
<html lang="es" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script
      src="https://unpkg.com/htmx.org@1.9.10"
      integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC"
      crossorigin="anonymous"
    ></script>
    <title>Pricing Dashboard</title>
  </head>
  <body>
    <header class="container-fluid site-header">
      <div class="header-left-section">
        <div class="logo-area">
          <a href="/"
            ><img
              src="{{ url_for('static', filename='images/logo-llosa.png') }}"
              style="height: 110px"
              alt="Logo Llosa"
          /></a>
        </div>
        <!-- Este bloque es para el selector de proyecto -->
        <div class="project-selector-wrapper">
          {% block project_selector %}{% endblock %}
        </div>
      </div>
      <nav class="main-nav">
        <ul>
          <li><a href="/">Dashboard</a></li>
          <li><a href="/pricing">Pricing</a></li>
          <li><a href="#">Análisis</a></li>
        </ul>
      </nav>
    </header>

    <div class="main-layout-grid">
      <main class="main-content">{% block content %}{% endblock %}</main>
      <aside class="sidebar-placeholder">
        {% block sidebar %}{% endblock %}
      </aside>
    </div>

    <script>
      function toggleDropdown() {
        const dropdown = document.getElementById("tipologia-dropdown");
        dropdown.classList.toggle("show");
      }

      function handleAllCheckbox(checkbox) {
        const individualCheckboxes = document.querySelectorAll(
          'input[name="tipologia"][value!=""]'
        );
        const form = checkbox.closest("form");

        if (checkbox.checked) {
          individualCheckboxes.forEach((cb) => (cb.checked = false));
        }

        // Disparar el evento change en el formulario para que HTMX lo detecte
        form.dispatchEvent(new Event("change", { bubbles: true }));

        // Mantener el dropdown abierto
        event.stopPropagation();
      }

      function handleIndividualCheckbox(checkbox) {
        const allCheckbox = document.getElementById("all-tipologias");
        if (checkbox.checked) {
          allCheckbox.checked = false;
        }
        // Mantener el dropdown abierto
        event.stopPropagation();
      }

      // Cerrar dropdown al hacer clic fuera
      window.onclick = function (event) {
        const dropdown = document.getElementById("tipologia-dropdown");
        const dropdownContainer = document.querySelector(".dropdown-container");

        // Solo cerrar si el clic no es dentro del dropdown ni en el botón toggle
        if (
          !dropdownContainer.contains(event.target) &&
          !event.target.matches(".dropdown-toggle")
        ) {
          if (dropdown.classList.contains("show")) {
            dropdown.classList.remove("show");
          }
        }
      };
    </script>
  </body>
</html>
